<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/cc4i/multi-k8s/solutions/play-k3s/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>K3s integrate Google Cloud Provider on GCE - Kubernetes on Google Cloud</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "K3s integrate Google Cloud Provider on GCE";
        var mkdocs_page_input_path = "solutions/play-k3s.md";
        var mkdocs_page_url = "/cc4i/multi-k8s/solutions/play-k3s/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Kubernetes on Google Cloud
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">General</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/prepare-gke/">Preparing GKE cluster for PRODUCTION</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Networking</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../networking/single-zone/">Deploy workload into single zone with high availability</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../networking/asm-locality/">Reduce inter-zone traffic with Anthhos Service Mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../networking/glb-locality/">Hybrid connectivity with services on AWS EKS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Security</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/workload-idetity/">Acccessing AWS services from GKE through workload identity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Solutions</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">K3s integrate Google Cloud Provider on GCE</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#provision-k3s-on-gce-with-cloud-controller-manager-ccm">Provision K3s on GCE with Cloud Controller Manager (CCM)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#all-in-one-quick-start-example">All-in-one quick-start example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#high-availability-and-auto-scalability-k3s-cluster">High-Availability and auto-scalability K3s Cluster</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#clean-up">Clean up</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Workaround</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../workaround/startup-script/">Run a boortrap script when launching nodes in GKE</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../license.md">License</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../release-notes.md">Release Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Kubernetes on Google Cloud</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Solutions &raquo;</li>
      <li>K3s integrate Google Cloud Provider on GCE</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="k3s-on-gcp">K3s on GCP</h1>
<h2 id="provision-k3s-on-gce-with-cloud-controller-manager-ccm">Provision K3s on GCE with Cloud Controller Manager (CCM)</h2>
<blockquote>
<p>Key points:
- Grant server &amp; agent nodes with permission in order to provision network resources.
- Allow port:60000 in the firewall rules.
- Following guidance to build CCM and push into your own image registry.
- Configure RBAC and allow CCM working properly, see <a href="../../manifests/ccm-k3s/">reference</a>.</p>
<p>Steps
- Create service account with proper permissions.
- Create instance template for K3s server.
- Create managed instance group with server template.
- Install K3s server side.
- Create agent instances template for K3s agent.
- Cerate managed instance group with agent template.
- Taint server node.
- Deploy CCM for GCE into K3s cluster.</p>
</blockquote>
<p><br></p>
<h2 id="all-in-one-quick-start-example">All-in-one quick-start example</h2>
<p>The k3s cluster uses managed instance group for both server and agent nodes for high available purpose, but no auto scaling capability, no external database.</p>
<pre><code class="language-sh">
git clone https://github.com/cc4i/multi-k8s.git
cd multi-k8s/hack &amp;&amp; ./k3s-quickstart.sh

</code></pre>
<h2 id="high-availability-and-auto-scalability-k3s-cluster">High-Availability and auto-scalability K3s Cluster</h2>
<p>The K3s cluster leverages managed instance group for both server and agent nodes, integrate with internal load balance with server nodes to provide fixed registeration address. Configure auto scaling policy with CPU utilization by default, using Cloud SQL as external database.</p>
<pre><code class="language-sh"></code></pre>
<h2 id="clean-up">Clean up</h2>
<pre><code class="language-sh">
cd multi-k8s/hack &amp;&amp; ./k3s-quickstart-cleanup.sh

</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../security/workload-idetity/" class="btn btn-neutral float-left" title="Acccessing AWS services from GKE through workload identity"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../workaround/startup-script/" class="btn btn-neutral float-right" title="Run a boortrap script when launching nodes in GKE">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../security/workload-idetity/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../workaround/startup-script/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
